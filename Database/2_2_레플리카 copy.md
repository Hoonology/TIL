# 많은 사용자 - 레플리카
# INDEX
- [많은 사용자 - 레플리카](./2_2_%EB%A0%88%ED%94%8C%EB%A6%AC%EC%B9%B4%20copy.md)
    - [장점](#장점)
        - [1. 동기식 복제](#1-동기식-복제)
        - [2. 비동기식 복제](#2-비동기식-복제)
        - [3. 반동기식 복제](#3-반동기식-복제)

---
<br>

> 많은 사용자가 발생함에 따른 문제를 해결하기 위한 방법 - 레플리카

 데이터베이스의 복사본을 저장하는 각각의 노드인 레플리카(replica : 복제서버)를 활용하여 문제를 해결  
 데이터의 중복성이 발생하는데, 이 중복성으로 인해서 얻을 수 있는 장점이 존재하며, 그에 따라 해결해야하는 문제점들 역시 존재한다.


## 장점
### 1. 시스템 장애 발생시에도 동작할 수 있도록 가용성을 확보한다.  
 레플리카를 활용한 데이터베이스 구조를 구현할 경우 일부 노드가 사용불가능 상태라면 해당 데이터는 남은 다른 노드를 통해 여전히 제공할 수 있다는 장점이 있다.
 > 리더가 되는 데이터베이스와 동일한 데이터를 레플리카들이 가지고 있기 때문에, 리더 데이터베이스에 화재, 지진, 네트워크 오류 등의 장애 상황이 발생하더라도  
 레플리카 중 하나를 새로운 리더로 지정하고 사용자의 요청을 새로운 리더로 연결하여, 서비스가 중단되는 시간을 최소화 할 수 있다.

- 레플리카 데이터베이스는 원본 데이터베이스와 동일한 스키마를 사용하므로 응용 프로그램에서 변경할 필요가 없다.
- 레플리카 데이터베이스를 사용하면 읽기 작업을 분산시키고, 읽기 작업을 처리하는 데 필요한 시간을 줄일 수 있다.
- 레플리카 데이터베이스는 원본 데이터베이스와 동일한 스키마를 사용하므로 쓰기 작업은 원본 데이터베이스에서만 수행할 수 있다.

### 2. 읽기 쿼리 제공 장비 수를 확장해 읽기 처리량을 늘린다.
> 웹 기반 애플리케이션 : 읽기 > 쓰기  

- 읽기 요청이 하나의 데이터베이스에 쏠리게 되면 발생하는 성능저하 문제 해결
    - 레플리카를 읽기전용 데이터베이스로 활용한다.
    - 레플리카는 최종적으로 리더와 같은 데이터를 가지고 있기 때문에 사용자들이 읽기 요청을 보낼 때 해당사항을 처리하고,  
    사용자 트래픽이 각 데이터베이스로 분산되기 때문에 성능향상에 도움이 된다.

### 3. 지연시간을 감소시킨다.
> 데이터베이스가 데이터를 요청하는 곳과 지리적으로 멀게 되면 응답시간이 늦어진다.  

레플리카의 위치를 각 지역에 분산시켜 배치하면서 지연시간을 감소시킨다.

<br>
<br>

## 레플리카 활용 시 고려해야할 사항
모든 데이터베이스가 정확히 같은 데이터를 가지고 있게 한다.  
리더 데이터베이스에 저장 + 모든 레플리카에도 똑같이 저장  
- 동기식 복제
- 비동기식 복제


### 1. 동기식 복제
동기식으로 복제가 진행되는 레플리카 구조에서는 리더의 데이터 처리와 별개로 레플리카에서의 데이터 처리까지 모두 완료되어야만 프로세스가 진행되고, 레플리카와 리더 데이터베이스가 일관성 있게 최신 데이터 복사본을 가지고 있는 것을 보장할 수 있다.  

![동기](./assets/%EB%8F%99%EA%B8%B0.png)  

동기식 복제의 경우 네트워크 문제나, 다른 이유로 레플리카가 정상적으로 데이터처리 작업을 완료할 수 없는 경우 응답을 받지 못한 리더 데이터베이스 역시 프로세스를 진행하지 못한다. 리더는 모든 쓰기를 차단하고 동기 레플리카가 회복되기를 기다리기 때문에 시스템 운영이 멈출수 있는 위험이 있다.

![동기문제](./assets/%EB%8F%99%EA%B8%B0%EB%AC%B8%EC%A0%9C.png)


### 2. 비동기식 복제
리더가 레플리카의 처리 응답을 기다리지 않는다. 리더는 레플리카에 데이터 처리를 요청한 후 자신의 작업을 완료하면 사용자의 요청에 바로 응답하고 쓰기 처리를 계속할 수 있다.  
리더 데이터베이스에 문제만 없다면 레플리카의 상태와 무관하게 사용자에게 서비스를 지속적으로 제공한다.

![비동기](./assets/%EB%B9%84%EB%8F%99%EA%B8%B0.png)  

하지만 레플리카가 **읽기 전용**으로 이용되고 있을 경우, 사용자에게 리더와 같은 응답을 주지 못하는 경우가 발생할 수 있다.  
데이터의 불일치가 발생하기 때문에 불일치 상태가 길어지는 경우 큰 문제가 될 수 있고,  
리더가 잘못되고 복구할 수 없는 상황이 발생 시, 팔로워에게 복제되지 못한 모든 처리가 유실될 수 있으며, 클라이언트에게는 정상 작동을 알린 이후임에도 불구하고 지속성을 보장하지 못하는 문제가 발생할 수 있다.  

![비동기문제](./assets/%EB%B9%84%EB%8F%99%EA%B8%B0%EB%AC%B8%EC%A0%9C.png)

### 3. 반동기식 복제
두 복제 방식의 장단점 보완
- 래플리카 1 : 동기식 복제
- others : 비동기식 복제

![반동기](./assets/%EB%B0%98%EB%8F%99%EA%B8%B0.png)